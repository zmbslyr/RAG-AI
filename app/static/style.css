:root {
  --brand: #2d6cdf;
  --bg: #2f3136;         /* Dark background for outer app */
  --panel: #ffffff;      /* White panel background */
  --subtle: #f9fafb;     /* Very light gray for headers/backgrounds */
  --border: #e5e7eb;
  --text: #1f2937;
  --text-light: #6b7280;
  --user-msg-bg: #f3f4f6; 
}

* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  overflow: hidden;
}

/* ===== 50/50 SPLIT ===== */
.app {
  display: flex;
  height: 100vh;
  width: 100vw;
}

/* Left / Right panes */
.left-pane, .right-pane {
  display: flex;
  flex-direction: column;
  background: var(--panel);
  height: 100%;
}

.left-pane  { flex: 1 1 50%; border-right: 1px solid var(--border); }
.right-pane { flex: 1 1 50%; position: relative; }

/* Headers - RESTORED TO BLUE */
.pane-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--brand); /* Blue background */
  color: white;             /* White text */
  font-weight: 600;
  z-index: 10;
}

.viewer-controls select {
  font-size: 0.85rem;
  padding: 4px 8px;
  border: 1px solid rgba(255,255,255,0.5);
  background: rgba(255,255,255,0.1);
  color: white;
  border-radius: 6px;
}
.viewer-controls select option {
  background: white;
  color: black;
}

/* PDF viewer */
.viewer-wrap {
  flex: 1 1 auto;
  min-height: 0;
  background: #525659; 
}
#pdfViewer { width: 100%; height: 100%; border: 0; }

/* ===== RIGHT PANE: DATABASE & UPLOAD ===== */
.db-controls {
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  background: var(--subtle);
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 10px;
}
.db-controls select {
  padding: 4px 8px;
  border-radius: 4px;
  border: 1px solid var(--border);
}

/* Upload Section - Grid Layout to prevent shifts */
.upload-section {
  display: grid;
  grid-template-columns: 1fr auto; /* Input takes remaining space, button takes min */
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  background: var(--panel);
}

.upload-form-row {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0; /* Critical for text truncation in flex children */
  width: 100%;
}

/* Truncate file input text */
.upload-section input[type="file"] {
  min-width: 0;
  flex: 1;
  font-size: 0.85rem;
  text-overflow: ellipsis;
}

.upload-btn {
  background: var(--brand);
  color: white;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  font-size: 0.85rem;
  cursor: pointer;
  font-weight: 500;
  white-space: nowrap;
}
.upload-btn:hover { opacity: 0.9; }

.upload-status-area {
  font-size: 0.8rem;
  color: var(--text-light);
  text-align: right;
  white-space: nowrap;
  min-width: 80px;
  display: flex;
  justify-content: flex-end;
  align-items: center;
}

/* Spinner */
.processing-container { display: flex; align-items: center; gap: 6px; }
.spinner { width: 14px; height: 14px; border-radius: 50%; border: 2px solid #ddd; border-top: 2px solid var(--brand); animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== CHAT SECTION ===== */
.chat-section {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--panel);
  position: relative; /* Crucial for absolute positioning of input */
}

.chat-log {
  flex: 1;
  overflow-y: auto;
  padding: 20px 0;
  /* Large bottom padding so the last message clears the floating input */
  padding-bottom: 150px; 
  display: flex;
  flex-direction: column;
  gap: 0;
}

/* Base Row Style */
.message-row {
  display: flex;
  width: 100%;
  padding: 12px 20px;
  border-bottom: none;
}

/* --- ASSISTANT: CENTERED --- */
.message-row.assistant {
  justify-content: center; /* Centers the inner block in the screen */
  background: transparent;
  border: none;
}

/* --- USER: RIGHT SIDED --- */
.message-row.user {
  justify-content: flex-end; /* Pushes the inner block to the right edge */
  background: transparent;
}

/* Inner Container (The text + avatar block) */
.message-inner {
  display: flex;
  gap: 16px;
  width: 100%;
  max-width: 768px; /* Keeps AI text readable width */
}

/* Flip User content so Avatar is on the right */
.message-row.user .message-inner {
  flex-direction: row-reverse;
  /* Optional: allows the bubble to shrink to fit content instead of taking full 768px */
  width: auto; 
  max-width: 85%; 
}

/* Avatars */
.avatar {
  width: 32px;
  height: 32px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-weight: bold;
  font-size: 14px;
}
.avatar.user-avatar { background: #ececec; color: #333; }
.avatar.ai-avatar { background: var(--brand); color: white; }

/* Message Text */
.message-content {
  flex: 1;
  min-width: 0;
  line-height: 1.6;
  font-size: 1rem;
  color: var(--text);
}

/* Add a bubble to User Text so it looks distinct on the right */
.message-row.user .message-content {
  background: var(--user-msg-bg); /* Light gray variable */
  padding: 10px 16px;
  border-radius: 12px 0 12px 12px; /* Point to avatar */
  text-align: left; /* Text stays left-aligned inside bubble for readability */
}

/* Markdown styles */
.message-content p { margin-top: 0; margin-bottom: 1em; }
.message-content p:last-child { margin-bottom: 0; }
.message-content ul { padding-left: 20px; margin: 0.5em 0; }
.message-content code { background: #eee; padding: 2px 4px; border-radius: 4px; font-family: monospace; font-size: 0.9em; }
.message-content pre { background: #2f3136; color: #fff; padding: 12px; border-radius: 8px; overflow-x: auto; }

.sources-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee; font-size: 0.9rem; }
.sources-section h4 { margin: 0 0 8px 0; font-size: 0.85rem; text-transform: uppercase; color: var(--text-light); }
.sources-section a { color: var(--brand); text-decoration: none; font-weight: 500; }
.sources-section a:hover { text-decoration: underline; }

/* ===== INPUT AREA ===== */
.input-container {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 20px;
  padding-top: 60px; /* Extra top padding for the gradient fade */
  
  /* The Gemini Fade: Transparent -> White -> White */
  background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, var(--panel) 50%, var(--panel) 100%);
  z-index: 20;
}

.input-wrapper {
  max-width: 768px;
  margin: 0 auto;
  position: relative;
  border: 1px solid #ccc;
  border-radius: 12px;
  background: white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  display: flex;
  align-items: flex-end;
  padding: 8px;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.input-wrapper:focus-within {
  border-color: var(--brand);
  box-shadow: 0 2px 8px rgba(45, 108, 223, 0.15);
}

.input-wrapper textarea {
  flex: 1;
  border: none;
  background: transparent;
  resize: none;
  padding: 8px 10px;
  min-height: 24px;
  max-height: 200px;
  outline: none;
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
}

/* ... (Keep .send-btn and other styles below this as they were) ... */

/* FIXED SELECTOR: was .chat-input textarea */
.input-wrapper textarea {
  flex: 1;
  border: none;
  background: transparent;
  resize: none; /* DISABLING RESIZE HERE */
  padding: 8px 10px;
  min-height: 24px;
  max-height: 200px;
  outline: none;
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
}

.send-btn {
  background: var(--brand);
  color: white;
  border: none;
  border-radius: 8px;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  margin-bottom: 2px;
  transition: background 0.2s;
}
.send-btn:hover { background: #1d56bf; }
.send-btn:disabled { background: #ccc; cursor: default; }
.send-btn svg { width: 16px; height: 16px; fill: white; }

/* Logout Button (White on Blue) */
.logout-btn {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.4);
  padding: 4px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.85rem;
  transition: background 0.2s;
}
.logout-btn:hover { background: rgba(255, 255, 255, 0.4); }

.thinking-dots::after { content: ' .'; animation: dots 1s steps(5, end) infinite; }
@keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ' '; } }